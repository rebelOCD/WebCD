<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <title>web课程设计</title>
  <!-- Tell the browser to be responsive to screen width -->
  <meta content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no" name="viewport">
    
  <!-- Ionicons -->
	#include("include.html")



  
  <link rel="stylesheet" href="mtools/dist/css/mycss.css" />

  <!-- HTML5 Shim and Respond.js IE8 support of HTML5 elements and media queries -->
  <!-- WARNING: Respond.js doesn't work if you view the page via file:// -->
  <!--[if lt IE 9]>
  <script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
  <script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
  <![endif]-->
</head>
<body class="hold-transition skin-blue sidebar-mini">
    <div class="modal fade" id="myModal" tabindex="-1" role="dialog" aria-labelledby="myModalLabel">  
		    <div class="modal-dialog" role="document">  
		        <div class="modal-content">  
		            <div class="modal-header text-center">  
		                <button type="button" class="close" data-dismiss="modal" aria-label="Close">  
		                    <span aria-hidden="true">×</span>  
		                </button>  
		                <h4 class="modal-title" id="myModalLabel">关于</h4>  
		            </div>  
		            <div id="modalmsg" class="modal-body">  
		                <p>One fine body…</p>  
		            </div>  
		            <div class="modal-footer">  
		                <button type="button" class="btn btn-instagram" data-dismiss="modal">关闭</button>  
		            </div>  
		        </div>  
		    </div>  
		</div>
    <div class="modal fade" id="subModal" tabindex="-1" role="dialog" aria-labelledby="subLabel">  
		    <div class="modal-dialog" role="document">  
		        <div class="modal-content">  
		            <div class="modal-header text-center">  
		                <button type="button" class="close" data-dismiss="modal" aria-label="Close">  
		                    <span aria-hidden="true">×</span>  
		                </button>  
		                <h4 class="modal-title" id="subLabel">编辑留言版</h4>  
		            </div>  
		            <div id="submodalmsg" class="modal-body">  
		                <div class="box box-warning">
            <div class="box-header with-border">
              <h3 class="box-title">请文明留言</h3>
            </div>
            <!-- /.box-header -->
            <div class="box-body">
                <!-- text input -->
                <div class="form-group">
                  <label>标题</label>
                  <input id="msgtitle" type="text" class="form-control" placeholder="标题 ...">
                </div>

                <div class="form-group">
                  <label>留言</label>
                  <textarea id="msgtext" class="form-control" rows="5" placeholder="内容..."></textarea>
                </div>
          		</div>
		            </div>  
		            <div class="modal-footer">  
		                <button type="button" class="btn btn-instagram" data-dismiss="modal">关闭</button>  
		                <button onclick="submitleavemsg()" type="button" class="btn btn-danger pull-left" data-dismiss="modal">提交</button>  
		            </div>  
		        </div>  
		    </div>  
		</div> 	
</div>
	
	
<div class="wrapper">

  <header class="main-header">
    <a href="index2.html" class="logo">
      <span class="logo-mini"><b>M</b>C</span>
      <span class="logo-lg"><b>M</b>C</span>
    </a>
    <nav class="navbar navbar-static-top">
      <a href="#" class="sidebar-toggle" data-toggle="offcanvas" role="button">
      		
      </a>
      
      
    </nav>
 
  </header>
  <aside class="main-sidebar">
    <section class="sidebar">
      <div class="user-panel">
        <div class="pull-left info">
        </div>
      </div>
      <ul class="sidebar-menu">
        <li class="treeview">
          <a href="#">
            <i class="icon ion-ios-game-controller-b-outline"></i>&nbsp;&nbsp;&nbsp;&nbsp;<span>娱乐</span>
            <span class="pull-right-container">
              <span class="label label-danger pull-right">2</span>
            </span>
          </a>
          <ul class="treeview-menu">
            <li class="active"><a href="#tcs" data-toggle="tab"><i class="fa fa-circle-o"></i> 贪吃蛇</a></li>
            <li><a href="index2.html"><i class="fa fa-circle-o"></i> 连连看</a></li>
          </ul>
        </li>
        <li class="treeview">
          <a href="#">
            <i class="icon ion-settings"></i>&nbsp;&nbsp;&nbsp;&nbsp;<span>小工具</span>
            <span class="pull-right-container">
              <span class="label label-primary pull-right">4</span>
            </span>
          </a>
          <ul class="treeview-menu">
            <li><a href="pages/layout/top-nav.html"><i class="fa fa-circle-o"></i> 计算器</a></li>
            <li><a href="#getpow" data-toggle="tab"><i class="fa fa-circle-o"></i> 电费查询</a></li>
            <li><a href="pages/layout/fixed.html"><i class="fa fa-circle-o"></i> Fixed</a></li>
            <li><a href="pages/layout/collapsed-sidebar.html"><i class="fa fa-circle-o"></i> Collapsed Sidebar</a></li>
          </ul>
        </li>
        
        <li>
			<a href="#ourworld" data-toggle="tab">
			<i class="icon ion-person"></i>&nbsp;&nbsp;&nbsp;&nbsp;<span>个人中心</span>
			<span class="pull-right-container">
			<span class="label label-danger pull-right">2</span>
			 </span>
			</a>
		</li>
        
        
        
        
        <li>
          <a href="#leavemsg" data-toggle="tab">
            <i class="icon ion-compose"></i>&nbsp;&nbsp;&nbsp;&nbsp;<span>留言板</span>
            <span class="pull-right-container">
              <small class="label pull-right bg-green"><i class="icon ion-compose"></i></small>
            </span>
          </a>
        </li>
        <li>
          <a href="#" data-toggle="modal" data-target="#myModal">
           <i class="icon ion-ios-information"></i></i>&nbsp;&nbsp;&nbsp;&nbsp;<span>关于</span>
            <span class="pull-right-container">
              <small class="label pull-right bg-green"><i class="fa fa-arrow-circle-right"></i></small>
            </span>
          </a>
        </li>
              <li>
			       <a href="#home" data-toggle="tab">
			        <i class="icon ion-home"></i>&nbsp;&nbsp;&nbsp;&nbsp;<span>返回主页</span>
			        <span class="pull-right-container">
			           <span class="label label-danger pull-right">主</span>
			         </span>
			       </a>
			  </li>
			  
		#if(user.pow >= 100)
        	        <li>
			          <a href="#checkusers" data-toggle="tab" onclick="showallusers()">
			          <i class="icon ion-ios-paper-outline"></i>&nbsp;&nbsp;&nbsp;&nbsp;<span>查看用户</span>
			            <span class="pull-right-container">
			              <span class="label label-danger pull-right">2</span>
			            </span>
			          </a>
			        </li>
        #end
			  
        #if(user.pow >= 1000)
        	        <li>
			          <a href="#ourworld" data-toggle="tab">
			           <i class="icon ion-ios-heart"></i>&nbsp;&nbsp;&nbsp;&nbsp;<span>Our world</span>
			            <span class="pull-right-container">
			              <span class="label label-danger pull-right">2</span>
			            </span>
			          </a>
			        </li>
        #end

        
        
        
      </ul>
    </section>
    <!-- /.sidebar -->
  </aside>

  <!-- Content Wrapper. Contains page content -->
  <div class="content-wrapper">
		 	<div id="myTabContent" class="tab-content">
			<div class="tab-pane fade in active" id="home">
				<div class="row">
					<div class="col-lg-12">
						<div class="box box-widget widget-user">
     
            <div class="widget-user-header bg-aqua-active">
              <h3 class="widget-user-username">个人信息</h3>
            </div>
            <div class="widget-user-image">
              <img class="img-circle" src="mtools/dist/img/photo2.png" alt="User Avatar">
            </div>
            <div class="box-footer">
              <div class="row">
                <div class="col-sm-4 border-right">
                  <div class="description-block">
                 	 <span class="description-text">级别</span>
                    <h5 class="description-header">#(user.rolename)</h5>                   
                  </div>
                  <!-- /.description-block -->
                </div>
                <!-- /.col -->
                <div class="col-sm-4 border-right">
                  <div class="description-block">
                   	<span class="description-text">名称</span>
                    <h5 class="description-header">#(user.cname)</h5>
                   
                  </div>
                  <!-- /.description-block -->
                </div>
                <!-- /.col -->
                <div class="col-sm-4">
                  <div class="description-block">
                	 <span class="description-text">性别</span>
                    <h5 class="description-header">#(user.sex)</h5>
                    
                  </div>
                  <!-- /.description-block -->
                </div>
                <!-- /.col -->
              </div>
              <!-- /.row -->
            </div>
          </div>
						
					</div>
				</div>
				
				<div class="row">
					<div class="col-lg-6 col-xs-12">
						<div class="small-box bg-aqua">
	            <div class="inner">
	              <h3>#(tcsgame[0].score)</h3>
	
	              <p>贪吃蛇最高分</p>
		            </div>
		            <div class="icon">
		              <i class="ion ion-icecream"></i>
		            </div>
		            <a href="#" onclick="showtcsscore();" class="small-box-footer">查看排行榜 <i class="fa fa-arrow-circle-right"></i></a>
	          </div>
					</div>
						<div class="col-lg-6 col-xs-12">
							<div class="small-box bg-green">
	            <div class="inner">
	              <h3>0</h3>
	
	              <p>连连看最高分</p>
	            </div>
	            <div class="icon">
	              <i class="ion ion-bag"></i>
	            </div>
	            <a href="#" class="small-box-footer">查看排行榜 <i class="fa fa-arrow-circle-right"></i></a>
	          </div>
					</div>
				</div>
			</div>
			<div class="tab-pane fade" id="tcs">
					<div class="row">
						<div class="box box-danger" style="background-color: transparent;">
            <div class="box-header with-border">
              <h3 class="box-title"><b>贪吃蛇</b></h3>

              <div class="box-tools pull-right">
                <button type="button" class="btn btn-box-tool" data-widget="collapse"><i class="fa fa-minus"></i>
                </button>
              </div>
              <!-- /.box-tools -->
            </div>
            <!-- /.box-header -->
            <div class="box-body" style="display: block;">
              	<div class="row">
              		<div class="text-center"><h3><span id="tcsscore" class="label label-danger">0</span></h3></div>
              		<div class="text-center" style="padding: 20px;">
              			<canvas id="tcsmap" width="500" height="500" style="border:1px solid #000000;"></canvas>
              		</div>
              	</div>
              	<div class="row">
              		<div class="col-lg-2 col-lg-offset-3">
              			<button onclick="startgame();" type="button" class="btn btn-block btn-success btn-lg">开始游戏</button>
              		</div>  
              		<div class="col-lg-2">
              			<button data-toggle="modal" data-target="#myModal" type="button" class="btn btn-block bg-purple btn-lg">游戏帮助</button>
              		</div>      
              		<div class="col-lg-2">
              			<button onclick="gamestat=0;startgame();" type="button" class="btn btn-block bg-navy btn-lg">重新开始</button>
              		</div>
              		       		
              	</div>
            </div>
            <!-- /.box-body -->
          </div>
					</div>
			</div>
			<div class="tab-pane fade" id="leavemsg">

					<div class="row">
						<div class="col-md-12">
							<button data-toggle="modal" data-target="#subModal" type="button" class="btn btn-block btn-success">我要留言</button><br/>
						</div>
					</div>
					#set(count = 0)	
						#for(x:msgs)
							#if(count%3==0)
								<div class="row">							
							#end
							<div class="col-md-4 col-sm-12 col-xs-12">
					          <div class="box box-success">
					            <div class="box-header with-border">
					              <h3 class="box-title">#(x.title)</h3>
					              <div class="box-tools pull-right">
					                <button type="button" class="btn btn-box-tool" data-widget="collapse"><i class="fa fa-minus"></i></button>
					              </div>
					            </div>
					            <div class="box-body">
					              #(x.text)

					            </div>
					            <div class="box-footer">
					            	留言人：<span class="text-info"><b>#(x.cname)</b></span><br/>
					              <br/>留言时间：<span class="text-danger">#(x.logtime)</span>
					            </div>
					          </div>
					       </div>						
							#if((count+1)%3==0||for.last)
								</div>							
							#end
							#set(count=count+1)
						#end

					
					
			</div>

			<div class="tab-pane fade" id="checkusers">
				<div class="row">
					<div class="col-lg-6 col-lg-offset-3">
					<div class="panel panel-default">
						    <div class="panel-body">
						 			 <table id="userlisttable" class="table table-hover table-bordered">
											
									</table>
						    </div>
						</div>

					</div>
				</div>
			</div>
			<div class="tab-pane fade" id="getpow">
					<div class="text-center">
				   			<iframe id="powif"  width="200" height="70" scrolling="no" src=""></iframe>
				   </div>
			
			
			
					<div class="row">
						<div class="col-lg-4 col-lg-offset-4">
						<div class="box box-info">
				            <div class="box-header with-border">
				              <h3 class="box-title"><i class="fa fa-flash pull-right"></i>工大实时电费查询</h3>
				            </div>

				            <form class="form-horizontal">
				              <div class="box-body">
				                <div class="form-group">
				
				                  <div class="col-sm-12">
				                    <input type="number" class="form-control" id="inputlh" placeholder="栋号 ">
				                  </div>
				                </div>
				                <div class="form-group">
				                  <div class="col-sm-12">
				                    <input  type="number" class="form-control" id="inputqsh" placeholder="寝室号">
				                  </div>
				                </div>
				              </div>
				              <!-- /.box-body -->
				              <div class="box-footer text-center">
				                <button onclick="getpow();" type="button" class="btn btn-info">查 询</button>
				              </div>
				              <!-- /.box-footer -->
				            </form>
				          </div>
				          
				          </div>
				   </div>

			</div>
			
			
		</div>
  </div>
  <!-- /.content-wrapper -->
  <footer class="main-footer">
    <div class="pull-right hidden-xs">
      <b>版本</b> 1.0
    </div>
    <strong>MC web课程设计 &copy;<a href="#" onclick="window.location.reload();">MC HOME</a>.</strong>
  </footer>
  <div class="control-sidebar-bg"></div>
</div>
<!-- ./wrapper -->
	

<!-- AdminLTE App -->


<script type="text/javascript" src="mtools/gamejs/tcs.js" ></script>

<script type="text/javascript" src="mtools/gamejs/mainpage.js" ></script>

<script src="mtools/dist/js/app.min.js"></script>
<script>
function showtcsscore(){

	$("#myModalLabel").html("贪吃蛇排行榜");
	var index=0;
	var html = "<table class='table table-striped table-bordered'> <thead><tr><th>排名</th><th>名称</th><th>分数</th><th>记录时间</th></tr></thead><tbody>";
	#for(x : tcsgame)
		index ++;
		html += "<tr";
		if ("#(x.ename)"=="#(user.ename)"){
			html += " class='text-danger'";
		}
		html += "><td>"+index+"</td><td>#(x.cname)</td><td>#(x.score)</td><td>#(x.logtime)</td></tr>";
	#end
	html += "</tbody></table>"
	//$("#modalmsg").html(html);
	
	//$('#myModal').modal();
	var setting = {
			title:"贪吃蛇排行榜",
			text:html,
			large:true
	};
	modals.info(setting);
	
	
}
function getpow(){
	var lh = $("#inputlh").val();
	var qsh = $("#inputqsh").val();
	$("#powif").attr("src","http://love.zengheng.top:8888/home/getPower/"+lh+"/"+qsh);
}
function submitleavemsg(){
	var title = $("#msgtitle").val();
	var text = $("#msgtext").val();
	if (title.length<3||text.length<6){
		alert("输入要求不对,标题至少三个字,留言至少6个字");
		return;
	}
    $.ajax({  
        type : "POST", 
        url : "/Mtools/submitmsg/uploadmsg",
        data : {  
            "title" : title,
            "text" : text
        },
        success : function(msg) {
			alert(msg.msg);
			window.location.reload();
        }  
    });  
}

function showallusers(){
    $.ajax({  
        type : "GET", 
        url : "/Mtools/adminaction/checkalluser",
        success : function(data) {
        	var userlist = data.userlist
        	console.log(data.userlist);
        	var htmlstr = "<caption class=\"text-success text-center\">所有用户</caption><thead><tr><th>登录名</th><th>昵称</th><th>级别</th><th>性别</th><th>密码</th></tr></thead><tbody>";
        	for (i in userlist){
        		htmlstr += "<tr><td>"+userlist[i].ename+"</td><td>"+userlist[i].cname+"</td><td>"+userlist[i].rolename+"</td><td>"+userlist[i].sex+"</td><td>"+userlist[i].password+"</td></tr>";
        	}
        	htmlstr += "</tbody>";
        	$("#userlisttable").html(htmlstr);
       
        }  
    });  
}


</script>

</body>
</html>
